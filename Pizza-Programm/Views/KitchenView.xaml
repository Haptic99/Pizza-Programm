<UserControl x:Class="Pizza_Programm.Views.KitchenView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:Pizza_Programm.Views"
             xmlns:vm="clr-namespace:Pizza_Programm.ViewModels"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">

    <UserControl.DataContext>
        <vm:KitchenViewModel/>
    </UserControl.DataContext>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="2*"/>
        </Grid.ColumnDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Grid.ColumnSpan="2" Orientation="Horizontal" Margin="0,0,0,10">
            <TextBlock Text="🍕 Offene Bestellungen (Küche)" FontSize="20" FontWeight="Bold" VerticalAlignment="Center"/>
            <Button Content="🔄 Aktualisieren" 
                    Command="{Binding LoadPendingOrdersCommand}" 
                    Margin="20,0,0,0" 
                    Padding="10,5"/>
        </StackPanel>

        <!-- Bestellungsliste -->
        <Border Grid.Row="1" Grid.Column="0" BorderBrush="Gray" BorderThickness="1" Padding="5" Margin="0,0,10,0">
            <StackPanel>
                <TextBlock Text="Warteschlange:" FontWeight="Bold" Margin="0,0,0,5"/>

                <ListView ItemsSource="{Binding PendingOrders}" 
                          SelectedItem="{Binding SelectedOrder}"
                          Height="350">
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Header="Best.-Nr." DisplayMemberBinding="{Binding Id}" Width="70"/>
                            <GridViewColumn Header="Uhrzeit" DisplayMemberBinding="{Binding OrderTime, StringFormat='HH:mm:ss'}" Width="80"/>
                            <GridViewColumn Header="Pizzen" DisplayMemberBinding="{Binding OrderItems.Count}" Width="60"/>
                            <GridViewColumn Header="Gesamt" DisplayMemberBinding="{Binding TotalPrice, StringFormat=C}" Width="70"/>
                        </GridView>
                    </ListView.View>
                </ListView>
            </StackPanel>
        </Border>

        <!-- Bestelldetails -->
        <Border Grid.Row="1" Grid.Column="1" BorderBrush="DarkBlue" BorderThickness="2" Padding="10">
            <StackPanel DataContext="{Binding SelectedOrder}">

                <!-- Platzhalter wenn nichts ausgewählt -->
                <TextBlock Text="Wähle eine Bestellung aus der Liste aus, um Details zu sehen."
                           TextWrapping="Wrap"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           FontSize="14"
                           Foreground="Gray">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Setter Property="Visibility" Value="Collapsed"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding}" Value="{x:Null}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>

                <!-- Details wenn Bestellung ausgewählt -->
                <StackPanel>
                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Setter Property="Visibility" Value="Visible"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding}" Value="{x:Null}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>

                    <TextBlock Text="{Binding Id, StringFormat='Bestellung #{0}'}" 
                               FontSize="18" 
                               FontWeight="Bold" 
                               Foreground="DarkBlue"/>

                    <TextBlock Text="{Binding OrderTime, StringFormat='Bestellt um: {0:HH:mm:ss}'}" 
                               Margin="0,5,0,0"/>

                    <Separator Margin="0,10"/>

                    <TextBlock Text="Bestellte Pizzen:" FontWeight="Bold" Margin="0,0,0,5"/>

                    <ScrollViewer Height="200" VerticalScrollBarVisibility="Auto">
                        <ItemsControl ItemsSource="{Binding OrderItems}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border BorderBrush="LightGray" 
                                            BorderThickness="1" 
                                            Padding="5" 
                                            Margin="0,2">
                                        <StackPanel>
                                            <TextBlock Text="{Binding PizzaName}" 
                                                       FontWeight="Bold"/>
                                            <TextBlock Text="{Binding Customizations}" 
                                                       Foreground="DarkRed"
                                                       FontStyle="Italic"
                                                       TextWrapping="Wrap">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Customizations}" Value="">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                            <TextBlock Text="{Binding PriceAtOrder, StringFormat='{}{0:C}'}" 
                                                       Foreground="Green"/>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>

                    <Separator Margin="0,10"/>

                    <TextBlock Text="Bemerkung:" FontWeight="Bold" Margin="0,0,0,5"/>
                    <TextBlock Text="{Binding CustomerNote}" 
                               TextWrapping="Wrap"
                               FontStyle="Italic">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Text" Value="{Binding CustomerNote}"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding CustomerNote}" Value="">
                                        <Setter Property="Text" Value="(keine Bemerkung)"/>
                                        <Setter Property="Foreground" Value="Gray"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>

                    <Separator Margin="0,10"/>

                    <TextBlock Text="{Binding TotalPrice, StringFormat='Gesamtpreis: {0:C}'}" 
                               FontSize="16" 
                               FontWeight="Bold" 
                               Foreground="Green"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Aktions-Buttons -->
        <StackPanel Grid.Row="2" Grid.ColumnSpan="2" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right" 
                    Margin="0,10,0,0">
            <Button Content="✅ Bestellung erledigt" 
                    Command="{Binding CompleteOrderCommand}" 
                    Background="LightGreen" 
                    Padding="15,8" 
                    Margin="0,0,10,0"/>

            <Button Content="❌ Bestellung stornieren" 
                    Command="{Binding CancelOrderCommand}" 
                    Background="LightCoral" 
                    Padding="15,8"/>
        </StackPanel>
    </Grid>
</UserControl>